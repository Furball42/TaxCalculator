@{
    ViewData["Title"] = "Calculator";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-md-2">
        </div>
        <div class="col-md-8">
            <div class="card">
                <h5 class="card-header">
                    Tax Calculator
                </h5>
                <div class="card-body">
                    <form id="calcForm">
                        <div class="form-group">
                            <label for="txtPostalCode">
                                Postal Code
                            </label>
                            <input id="txtPostalCode" type="text" class="form-control" placeholder="Postal Code" value="1000" />
                        </div>
                        <div class="form-group">
                            <label for="txtIncome">
                                Annual Income
                            </label>
                            <input id="txtIncome" type="number" class="form-control" placeholder="Income" value="372900" />
                        </div>
                        <div class="form-group">
                            <button id="btnSubmit" type="button" class="btn btn-primary">
                                Calculate
                            </button>
                            <button id="btnReset" type="button" class="btn btn-success">
                                Reset
                            </button>
                        </div>
                        <div class="row">
                            <div class="col-md-12" id="warning">
                                <div class="alert alert-warning">
                                    Please complete all fields.
                                </div>
                            </div>
                        </div>                        
                    </form>                    
                </div>
                <div class="card-footer">
                    <div id="results">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="totalTaxValue">
                                        Total Tax
                                    </label>
                                    <h3 id="totalTaxValue"></h3>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="totalTaxValue">
                                        Total Tax Percentage
                                    </label>
                                    <h3 id="totalTaxPercentage"></h3>
                                </div>
                            </div>
                        </div>
                        <hr />
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="incomeBefore">
                                        Income Before Tax
                                    </label>
                                    <h4 id="incomeBefore"></h4>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="incomeAfter">
                                        Income After Tax
                                    </label>
                                    <h4 id="incomeAfter"></h4>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="monthlyTaxes">
                                        Monthly Tax
                                    </label>
                                    <h4 id="monthlyTaxes"></h4>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <table id="levelTable"class="table">
                                    <thead>
                                        <tr>
                                            <th>
                                                Min
                                            </th>
                                            <th>
                                                Max
                                            </th>
                                            <th>
                                                Rate
                                            </th>
                                            <th>
                                                Taxes
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>                                        
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-2">
        </div>
    </div>
</div>

@section scripts {

    <script type="text/javascript">

        $(document).ready(function(){

            $('#warning').hide();
            $('#results').hide();
            $('#levelTable').hide();

        });

        $('#btnReset').on('click', function () {

            $('#totalTaxValue').text("");
            $('#totalTaxPercentage').text("");
            $('#incomeBefore').text("");
            $('#incomeAfter').text("");
            $('#monthlyTaxes').text("");
            $('#txtIncome').val('');
            $('#txtPostalCode').val('');

            $('#warning').hide();
            $('#results').hide();
            $('#levelTable tbody tr').remove();
            $('#levelTable').hide();
        });


        $('#btnSubmit').on('click', function () {
            $('#levelTable tbody tr').remove();
            $('#levelTable').hide();

            var income = $('#txtIncome').val();
            var postalCode = $('#txtPostalCode').val();

            if (income == '' || postalCode == '')
                $('#warning').show();
            else {

                $('#results').show();

                $.ajax({
                    url: "http://localhost:5000/Calculation/DoTaxCalculation/" + income + "/" + postalCode,
                    type: "Get",
                    async: true,
                    success: function (data) {

                        $('#totalTaxValue').text(data.totalTaxes.toFixed(2));
                        $('#totalTaxPercentage').text(data.totalTaxPercentage.toFixed(2) + "%");
                        $('#incomeBefore').text(data.originalIncome.toFixed(2));
                        $('#incomeAfter').text(data.incomeAfterTax.toFixed(2));
                        $('#monthlyTaxes').text(data.totalMonthlyTaxes.toFixed(2));

                        var levelList = data.progressiveTaxByLevel;

                        if (levelList.length > 0) {
                            $('#levelTable').show();
                            for (var x = 0; x < levelList.length; x++) {  

                                var min = levelList[x].min.toFixed(2);
                                var max = levelList[x].max.toFixed(2);
                                var rate = levelList[x].rate.toFixed(2);
                                var taxes = levelList[x].levelTax.toFixed(2);

                                $('#levelTable tbody').append("<tr><td>" + min + "</td><td>" + max + "</td><td>" + rate + "</td><td>" + taxes + "</td></tr>");
                            }
                        }                        
                    },
                    error: function (request, message, error) {
                        alert(message);
                    }
                });
            }            
        });

    </script>

}
